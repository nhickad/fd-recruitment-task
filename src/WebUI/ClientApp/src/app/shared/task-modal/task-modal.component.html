<!-- task-modal.component.html -->

<div class="modal-overlay" (click)="onOverlayClick($event)" *ngIf="isOpen">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <!-- Modal Header -->
        <div class="modal-header">
            <h2 class="modal-title">Add New Task</h2>
            <button class="go-back-btn" (click)="onCancel()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor">
                    <path d="m12 19-7-7 7-7"></path>
                    <path d="m19 12H5"></path>
                </svg>
                Go Back
            </button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
            <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
                <!-- Title Field -->
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input
                        type="text"
                        class="form-input"
                        [class.error]="title?.invalid && (title?.dirty || title?.touched)"
                        placeholder="Enter task title..."
                        formControlName="title">
                    <div class="error-message"
                        *ngIf="title?.invalid && (title?.dirty || title?.touched)">
                        <span *ngIf="title?.hasError('required')">Title is
                            required</span>
                        <span *ngIf="title?.hasError('minlength')">Title must be
                            at least 3 characters</span>
                    </div>
                </div>

                <!-- Date Field -->
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <div class="date-input-container">
                        <input
                            type="date"
                            class="form-input date-input"
                            [class.error]="dueDate?.invalid && (dueDate?.dirty || dueDate?.touched)"
                            formControlName="dueDate">
                    </div>
                    <div class="error-message"
                        *ngIf="dueDate?.invalid && (dueDate?.dirty || dueDate?.touched)">
                        <span *ngIf="dueDate?.hasError('required')">Date is
                            required</span>
                    </div>
                </div>

                <!-- Priority Field -->
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <div class="priority-options">
                        <label class="priority-option">
                            <input
                                type="radio"
                                name="priority"
                                value="High"
                                formControlName="priority">
                            <span class="priority-indicator high"></span>
                            <span class="priority-text">Extreme</span>
                        </label>

                        <label class="priority-option">
                            <input
                                type="radio"
                                name="priority"
                                value="Medium"
                                formControlName="priority">
                            <span class="priority-indicator medium"></span>
                            <span class="priority-text">Moderate</span>
                        </label>

                        <label class="priority-option">
                            <input
                                type="radio"
                                name="priority"
                                value="Low"
                                formControlName="priority">
                            <span class="priority-indicator low"></span>
                            <span class="priority-text">Low</span>
                        </label>
                    </div>
                </div>

                <!-- Description and Upload Section -->
                <div class="form-row">
                    <!-- Task Description -->
                    <div class="form-group description-group">
                        <label class="form-label">Task Description</label>
                        <textarea
                            class="form-textarea"
                            [class.error]="description?.invalid && (description?.dirty || description?.touched)"
                            placeholder="Start writing here..."
                            rows="8"
                            formControlName="description">
              </textarea>
                        <div class="error-message"
                            *ngIf="description?.invalid && (description?.dirty || description?.touched)">
                            <span
                                *ngIf="description?.hasError('required')">Description
                                is required</span>
                            <span
                                *ngIf="description?.hasError('minlength')">Description
                                must be at least 10 characters</span>
                        </div>
                    </div>

                    <!-- Upload Image -->
                    <div class="form-group upload-group">
                        <label class="form-label">Upload Image</label>
                        <div class="upload-area"
                            (dragover)="onDragOver($event)"
                            (dragleave)="onDragLeave($event)"
                            (drop)="onDrop($event)"
                            [class.drag-over]="isDragOver">

                            <div class="upload-content" *ngIf="!selectedImage"
                                (click)="triggerFileInput()">
                                <svg class="upload-icon" width="40" height="40"
                                    viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor">
                                    <rect x="3" y="3" width="18" height="18"
                                        rx="2" ry="2"></rect>
                                    <circle cx="9" cy="9" r="2"></circle>
                                    <path
                                        d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                                </svg>
                                <p class="upload-text">Drag&Drop files here</p>
                                <button type="button" class="browse-btn"
                                    (click)="$event.stopPropagation(); triggerFileInput()">Browse</button>
                            </div>

                            <div class="image-preview" *ngIf="selectedImage">
                                <img [src]="selectedImage" alt="Preview"
                                    class="preview-image">
                                <button type="button" class="remove-image-btn"
                                    (click)="removeImage(); $event.stopPropagation()">
                                    <svg width="16" height="16"
                                        viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor">
                                        <line x1="18" y1="6" x2="6"
                                            y2="18"></line>
                                        <line x1="6" y1="6" x2="18"
                                            y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <input
                            #fileInput
                            type="file"
                            accept="image/*"
                            (change)="onFileSelected($event)"
                            style="display: none;">
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="submit" class="done-btn"
                        [disabled]="!isFormValid()">
                        Done
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>