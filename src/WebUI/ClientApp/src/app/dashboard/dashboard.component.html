<!-- Dashboard.component.html -->

<div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="user-profile">
            <div class="user-avatar">
                <img [src]="currentUser.avatar || 'assets/default-avatar.png'"
                    [alt]="currentUser.name">
            </div>
            <div class="user-info">
                <h4 class="user-name">{{ currentUser.name }}</h4>
            </div>
        </div>

        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item active">
                    <a href="#" class="nav-link">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                        </svg>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path
                                d="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z" />
                        </svg>
                        <span>Vital Task</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path
                                d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                        </svg>
                        <span>My Task</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path
                                d="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z" />
                        </svg>
                        <span>Task Categories</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path
                                d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
                        </svg>
                        <span>Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path
                                d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C16,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z" />
                        </svg>
                        <span>Help</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <button class="logout-btn" (click)="logout()">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path
                        d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z" />
                </svg>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header with White Background -->
        <header class="content-header">
            <div class="header-left">
                <h2 class="logo-header">To-Do<span
                        class="logo-accent">List</span></h2>
            </div>

            <div class="header-actions">
                <div class="search-container">
                    <input type="text" class="search-input"
                        placeholder="Search your task here..."
                        [(ngModel)]="searchQuery" (input)="onSearch()">
                    <button class="search-btn">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                        </svg>
                    </button>
                </div>

                <div class="date-display">
                    <span class="current-date">{{ currentDate | date:'EEEE'
                        }}</span>
                    <span class="current-date-full">{{ currentDate |
                        date:'dd/MM/yyyy' }}</span>
                </div>
            </div>
        </header>

        <!-- Content Body -->
        <div class="content-body">
            <!-- Welcome Section -->
            <section class="welcome-section">
                <h1 class="welcome-title">Welcome back, {{ currentUser.firstName
                    }} 👋</h1>
            </section>

            <!-- Main Layout -->
            <div class="main-layout">
                <!-- Left Section - Todo List -->
                <div class="todo-section">
                    <div class="todo-header">
                        <div>
                            <div class="todo-title">
                                <svg class="todo-icon" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor">
                                    <path
                                        d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline
                                        points="14,2 14,8 20,8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline
                                        points="10,9 9,10 12,13"></polyline>
                                </svg>
                                To-Do
                            </div>
                            <div class="todo-date">{{ currentDate |
                                date:'dd MMMM' }} • Today</div>
                            <div class="todo-count">{{ activeTasks.length
                                }}</div>
                        </div>
                        <button class="add-task-btn" (click)="addNewTask()">
                            <svg width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor">
                                <line x1="12" y1="5" x2="12" y2="19"
                                    stroke-width="2"></line>
                                <line x1="5" y1="12" x2="19" y2="12"
                                    stroke-width="2"></line>
                            </svg>
                            Add task
                        </button>
                    </div>

                    <div class="todo-list">
                        <div class="task-card" *ngFor="let task of activeTasks">
                            <div class="task-card-header">
                                <div class="task-status-indicator"
                                    [class]="getStatusClass(task.status)"></div>
                                <div class="task-main-content">
                                    <div class="task-title">{{ task.title
                                        }}</div>
                                    <div class="task-description">{{
                                        task.description }}</div>
                                    <div class="task-meta">
                                        <div class="task-priority"
                                            [class]="getPriorityClass(task.priority)">
                                            {{ task.priority }}
                                        </div>
                                        <div class="task-date">
                                            <svg width="12" height="12"
                                                viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor">
                                                <rect x="3" y="4" width="18"
                                                    height="18" rx="2" ry="2"
                                                    stroke-width="2"></rect>
                                                <line x1="16" y1="2" x2="16"
                                                    y2="6"
                                                    stroke-width="2"></line>
                                                <line x1="8" y1="2" x2="8"
                                                    y2="6"
                                                    stroke-width="2"></line>
                                                <line x1="3" y1="10" x2="21"
                                                    y2="10"
                                                    stroke-width="2"></line>
                                            </svg>
                                            {{ task.dueDate | date:'MMM dd' }}
                                        </div>
                                    </div>
                                </div>
                                <!-- 🖼️ IMAGE DISPLAY - This is the important part! -->
                                <div class="task-image" *ngIf="task.image">
                                    <img [src]="task.image" [alt]="task.title"
                                        class="task-thumbnail">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Section -->
                <div class="right-section">
                    <!-- Task Status Section -->
                    <div class="task-status-section">
                        <div class="status-header">
                            <svg class="status-icon" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor">
                                <polyline
                                    points="22,12 18,12 15,21 9,3 6,12 2,12"
                                    stroke-width="2"></polyline>
                            </svg>
                            Task Status
                        </div>

                        <div class="progress-rings">
                            <div class="progress-item">
                                <app-progress-ring
                                    [percentage]="taskStatus.completed.percentage"
                                    [color]="'#4ECDC4'"
                                    [size]="80">
                                </app-progress-ring>
                                <div class="progress-label">
                                    <span class="progress-number">{{
                                        taskStatus.completed.percentage
                                        }}%</span>
                                    <span class="progress-text">Completed</span>
                                </div>
                            </div>

                            <div class="progress-item">
                                <app-progress-ring
                                    [percentage]="taskStatus.inProgress.percentage"
                                    [color]="'#45B7D1'"
                                    [size]="80">
                                </app-progress-ring>
                                <div class="progress-label">
                                    <span class="progress-number">{{
                                        taskStatus.inProgress.percentage
                                        }}%</span>
                                    <span class="progress-text">In
                                        Progress</span>
                                </div>
                            </div>

                            <div class="progress-item">
                                <app-progress-ring
                                    [percentage]="taskStatus.notStarted.percentage"
                                    [color]="'#FF6B6B'"
                                    [size]="80">
                                </app-progress-ring>
                                <div class="progress-label">
                                    <span class="progress-number">{{
                                        taskStatus.notStarted.percentage
                                        }}%</span>
                                    <span class="progress-text">Not
                                        Started</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Completed Tasks Section -->
                    <div class="completed-section">
                        <div class="completed-header">
                            <svg class="completed-icon" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor">
                                <polyline points="20,6 9,17 4,12"
                                    stroke-width="2"></polyline>
                            </svg>
                            Completed Task
                        </div>

                        <div class="completed-list">
                            <div class="completed-task-card"
                                *ngFor="let task of completedTasks">
                                <div class="completed-status-indicator">
                                    <svg viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor">
                                        <polyline points="20,6 9,17 4,12"
                                            stroke-width="2"></polyline>
                                    </svg>
                                </div>
                                <div class="completed-task-content">
                                    <div class="completed-task-title">{{
                                        task.title }}</div>
                                    <div class="completed-task-time">Completed
                                        {{ getCompletedTime(task) }}</div>
                                </div>
                                <!-- 🖼️ IMAGE DISPLAY for completed tasks too -->
                                <div class="completed-task-image"
                                    *ngIf="task.image">
                                    <img [src]="task.image" [alt]="task.title"
                                        class="completed-task-thumbnail">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <app-task-modal
        [isOpen]="isTaskModalOpen"
        (onClose)="closeTaskModal()"
        (onTaskCreate)="onNewTaskCreate($event)">
    </app-task-modal>

</div>